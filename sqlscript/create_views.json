{
	"name": "create_views",
	"properties": {
		"folder": {
			"name": "datawarehouse_DDL_scripts"
		},
		"content": {
			"query": "/*\nView definitions for...\n- dbo.FactSales ✅\n- dbo.DimItem ✅\n- dbo.DimCustomer ✅\n- dbo.DimSalesPerson\n- dbo.DimDate -- or maybe not this one because it will be generated?\n*/\n\nUSE [spulletjes_DW]\nGO\n\nCREATE OR ALTER VIEW vw_FactSales AS\nSELECT\n    ol.OrderLineID AS OrderLineID-- included for source traceability\n    , ol.OrderID AS OrderID  -- included for source traceability\n    , StockItemID\n    -- , ol.Description -- same as [DimStockItem].[StockItemName]\n    -- , ol.PackageTypeID\n    , Quantity\n    , UnitPrice\n    , TaxRate\n    , PickedQuantity\n    -- , ol.PickingCompletedWhen AS orderLine_PickingCompletedWhen\n    , ol.LastEditedBy AS orderLine_LastEditedBy\n    , ol.LastEditedWhen AS orderLine_LastEditedWhen\n\n    , CustomerID\n    , SalespersonPersonID\n    -- , PickedByPersonID\n    -- , ContactPersonID\n    -- , BackorderOrderID\n    , YEAR(o.OrderDate) * 10000 + MONTH(o.OrderDate) * 100 + DAY(OrderDate) AS OrderDateKey\n    -- , ExpectedDeliveryDate\n    -- , CustomerPurchaseOrderNumber\n    -- , IsUndersupplyBackordered\n    -- , Comments\n    -- , DeliveryInstructions\n    -- , InternalComments\n    -- , o.PickingCompletedWhen AS order_PickingCompletedWhend\n    , o.LastEditedBy AS order_LastEditedBy\n    , o.LastEditedWhen AS order_LastEditedWhen\nFROM\n    OPENROWSET(\n        BULK 'https://dlsspul1234.dfs.core.windows.net/fsspul1234/silver/databases/SalesPurchaseDB/Sales.OrderLines.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [ol] -- OrderLines\nJOIN\n    OPENROWSET(\n        BULK 'https://dlsspul1234.dfs.core.windows.net/fsspul1234/silver/databases/SalesPurchaseDB/Sales.Orders.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [o] -- Orders\nON\n    [ol].[OrderID] = [o].[OrderID]\n\n\nCREATE OR ALTER VIEW vw_DimItem AS\nSELECT\n    i.[StockItemID]\n    , i.[StockItemName]\n    , i.[SupplierID]\n    , i.[ColorID]\n    , i.[UnitPackageID]\n    , i.[OuterPackageID]\n    , i.[Brand]\n    , i.[Size]\n    , i.[LeadTimeDays]\n    , i.[IsChillerStock]\n    -- , i.[Barcode]\n    , i.[TaxRate]\n    , i.[UnitPrice]\n    , i.[RecommendedRetailPrice]\n    -- , i.[TypicalWeightPerUnit]\n    -- , i.[MarketingComments]\n    -- , i.[InternalComments]\n    , i.[Photo]\n    -- , i.[CustomFields]\n    -- , i.[Tags]\n    -- , i.[SearchDetails]\n    -- , i.[LastEditedBy]\nFROM\n    OPENROWSET(\n        -- volgende regel verwacht maar één file! Als een tabel uit meerdere files bestaat moeten we eigenlijk naar een folder wijzen.\n        -- dan moeten we één folder per tabel hebben (i.p.v. alle tabellen in een folder samen)\n        BULK 'https://dlsspul1234.dfs.core.windows.net/fsspul1234/silver/databases/Warehouse/Warehouse.StockItems.parquet', \n        FORMAT = 'PARQUET'\n    ) AS [i] -- Items\n\n\nCREATE OR ALTER VIEW vw_DimCustomer AS\nSELECT\n    [CustomerID]\n    , p.[CustomerName]\n    , p.[BillToCustomerID]\n    , p.[CustomerCategoryID]\n    , p.[BuyingGroupID]\n    , p.[PrimaryContactPersonID]\n    -- , p.[AlternateContactPersonID]\n    , p.[DeliveryMethodID]\n    , p.[DeliveryCityID]\n    , p.[PostalCityID]\n    , p.[CreditLimit]\n    , p.[AccountOpenedDate]\n    , p.[StandardDiscountPercentage]\n    , p.[IsStatementSent]\n    , p.[IsOnCreditHold]\n    , p.[PaymentDays]\n    , p.[PhoneNumber]\n    -- , p.[FaxNumber]\n    -- , p.[DeliveryRun]\n    -- , p.[RunPosition]\n    , p.[WebsiteURL]\n    -- , p.[DeliveryAddressLine1]\n    -- , p.[DeliveryAddressLine2]\n    -- , p.[DeliveryPostalCode]\n    -- , p.[DeliveryLocation]\n    -- , p.[PostalAddressLine1]\n    -- , p.[PostalAddressLine2]\n    -- , p.[PostalPostalCode]\n    -- , p.[LastEditedBy]\nFROM\n    OPENROWSET(\n        BULK 'https://dlsspul1234.dfs.core.windows.net/fsspul1234/silver/databases/SalesPurchaseDB/Sales.Customer.paruqet', \n        FORMAT = 'PARQUET'\n    ) AS [p] -- People\n\n\n/*\n\nCREATE OR ALTER VIEW vw_DimSalesPerson AS\nSELECT\n    ...\nFROM\n    OPENROWSET(\n        BULK 'https://dlsspul1234.dfs.core.windows.net/fsspul1234/silver/csv/ApplicationPeopleSilver/*.parquet', -- check dit nog!\n        FORMAT = 'PARQUET'\n    ) AS [p] -- People\n\n\n*/",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "spulletjes_DW",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}